import{io as f}from"https://cdn.socket.io/4.7.5/socket.io.esm.min.js";import{_ as w,c as r,a as o,f as c,b as m,w as p,h as x,F as I,r as k,o as a,d as l,p as v,e as y}from"./index-itQC74gv.js";import{_ as b}from"./logo_small-1d6l-dhM.js";const C="/assets/logo_white-AiIJoPJw.png",D="/assets/streetlight-La1yFIpG.png",L="/assets/toggle-light-Mn1Hd3bC.png",d=f("https://daotaiwanapi.onrender.com",{withCredentials:!1}),M={data(){return{resultDataReady:!1,resultImageGet:!1,resultData:null,textureCookie:null,textureId:null,lightMode:!1}},methods:{toggleDarkMode(){document.querySelector(".app").classList.toggle("active"),this.lightMode=!this.lightMode;const e=document.querySelector(".toggle-switch");e.classList.toggle("active"),document.querySelector(".toggle-light").classList.toggle("active"),console.log(this.textureId),document.querySelector(".overlay").classList.toggle("active"),(this.resultImageGet!=null||this.textureId!=null)&&(e.classList.contains("active")?this.lightControllById(this.textureId,this.resultData.category,"light-on"):this.lightControllById(this.textureId,this.resultData.category,"light-off"))},lightControllById(t,e,s){try{d.emit(s,{_id:t,category:e})}catch(g){console.error("開關燈失敗:",g)}},fetchResultImage(t){fetch(`https://daotaiwanapi.onrender.com/results/${t}`,{method:"GET"}).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>{console.log(e),this.resultData=e.data[0],this.resultImageGet=!0,console.log(this.resultData.url)}).catch(e=>{console.error("Error:",e)})},downloadImage(){if(this.resultData){const t=document.createElement("a");t.href=this.resultData.url,console.log(t.href),t.download="DAO-Taiwan-result-image.png",fetch(t.href,{mode:"cors"}).then(e=>e.blob()).then(e=>{const s=window.URL.createObjectURL(e);t.href=s,document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(s)}).catch(e=>{console.error("Error downloading image:",e)})}}},created(){d.on("result-upload",t=>{console.log("伺服器傳送訊息:",t),console.log(this.textureId,t._id),t!=null&&this.textureId===t._id&&(this.fetchResultImage(this.textureId),this.resultData=t)}),d.on("light-on",t=>{console.log("伺服器傳送訊息:",t)}),d.on("light-off",t=>{console.log("伺服器傳送訊息:",t)})},mounted(){const t=document.cookie.split(";");for(let e=0;e<t.length;e++){const s=t[e].trim().split("=");if(s[0]==="textureCookie"){this.textureCookie=JSON.parse(s[1]),this.textureId=this.textureCookie._id,console.log(this.textureId),this.fetchResultImage(this.textureId);break}}}},i=t=>(v("data-v-7c188e07"),t=t(),y(),t),R=i(()=>o("h1",{class:"d-none"},"結果頁面",-1)),S={id:"app",class:"position-relative app",ref:"appContainer"},j={class:"my-0 mx-auto d-flex justify-content-between align-items-center"},B={key:0,class:"logo_white mx-auto pt-3",src:C,alt:"logo_white"},E={key:1,class:"logo_white mx-auto pt-3",src:b,alt:"logo_red"},N={class:"w-25 d-flex d-none"},O=["src"],G={class:"position-relative"},V=i(()=>o("img",{class:"streetlight",src:D,alt:"streetlight"},null,-1)),q=i(()=>o("img",{src:L,alt:"toggle-light",class:"streetlight toggle-light"},null,-1)),A=["src"],U=i(()=>o("div",{class:"overlay"},[l("點選按鈕照亮您的招牌"),o("br"),l("試著在場景中找到他吧！！")],-1)),F={class:"d-flex flex-column justify-content-between h-100 pb-5 pt-2 result-content"},J=i(()=>o("div",{class:"toggle-handle"},null,-1)),T=[J],H=i(()=>o("p",{class:"result-text pt-3"},[l("點選按鈕照亮您的招牌"),o("br"),l("試著在場景中找到他吧！！")],-1)),P={class:"d-flex justify-content-between"};function z(t,e,s,g,u,n){const _=k("router-link");return a(),r(I,null,[R,o("div",S,[o("nav",j,[u.lightMode?c("",!0):(a(),r("img",B)),u.lightMode?(a(),r("img",E)):c("",!0),o("div",N,[m(_,{class:"done-button",to:"/home"},{default:p(()=>[l("家")]),_:1})])]),this.resultData?(a(),r("img",{key:0,src:this.resultData.url,class:"result-image position-relative",alt:"result-image"},null,8,O)):c("",!0),o("div",G,[V,q,this.resultData?(a(),r("img",{key:0,src:this.resultData.url,class:"result-image position-relative",alt:"result-image"},null,8,A)):c("",!0),U]),o("div",F,[o("div",{class:"toggle-switch mx-auto",onClick:e[0]||(e[0]=(...h)=>n.toggleDarkMode&&n.toggleDarkMode(...h))},T),H,o("div",P,[o("a",{class:"upload-button",href:"#",onClick:e[1]||(e[1]=x((...h)=>n.downloadImage&&n.downloadImage(...h),["prevent"]))},"下載"),m(_,{class:"upload-button",to:"/gallery"},{default:p(()=>[l("大家ㄉ庫")]),_:1})])])],512)],64)}const X=w(M,[["render",z],["__scopeId","data-v-7c188e07"]]);export{X as default};
