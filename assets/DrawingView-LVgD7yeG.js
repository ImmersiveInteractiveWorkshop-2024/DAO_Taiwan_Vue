import{io as D}from"https://cdn.socket.io/4.7.5/socket.io.esm.min.js";import{_ as L,c as g,a as o,t as k,g as C,h as f,F as T,f as R,o as v,n as P,i as A,p as U,e as W}from"./index-ftthEBW5.js";import{_ as j}from"./logo_small-nh19fpU0.js";var w=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},S={exports:{}};(function(e,t){(function(h,c){c()})(w,function(){function h(i,a){return typeof a>"u"?a={autoBom:!1}:typeof a!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),a={autoBom:!a}),a.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(i.type)?new Blob(["\uFEFF",i],{type:i.type}):i}function c(i,a,u){var r=new XMLHttpRequest;r.open("GET",i),r.responseType="blob",r.onload=function(){y(r.response,a,u)},r.onerror=function(){console.error("could not download file")},r.send()}function l(i){var a=new XMLHttpRequest;a.open("HEAD",i,!1);try{a.send()}catch{}return 200<=a.status&&299>=a.status}function n(i){try{i.dispatchEvent(new MouseEvent("click"))}catch{var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),i.dispatchEvent(a)}}var s=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof w=="object"&&w.global===w?w:void 0,x=s.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),y=s.saveAs||(typeof window!="object"||window!==s?function(){}:"download"in HTMLAnchorElement.prototype&&!x?function(i,a,u){var r=s.URL||s.webkitURL,d=document.createElement("a");a=a||i.name||"download",d.download=a,d.rel="noopener",typeof i=="string"?(d.href=i,d.origin===location.origin?n(d):l(d.href)?c(i,a,u):n(d,d.target="_blank")):(d.href=r.createObjectURL(i),setTimeout(function(){r.revokeObjectURL(d.href)},4e4),setTimeout(function(){n(d)},0))}:"msSaveOrOpenBlob"in navigator?function(i,a,u){if(a=a||i.name||"download",typeof i!="string")navigator.msSaveOrOpenBlob(h(i,u),a);else if(l(i))c(i,a,u);else{var r=document.createElement("a");r.href=i,r.target="_blank",setTimeout(function(){n(r)})}}:function(i,a,u,r){if(r=r||open("","_blank"),r&&(r.document.title=r.document.body.innerText="downloading..."),typeof i=="string")return c(i,a,u);var d=i.type==="application/octet-stream",B=/constructor/i.test(s.HTMLElement)||s.safari,E=/CriOS\/[\d]+/.test(navigator.userAgent);if((E||d&&B||x)&&typeof FileReader<"u"){var b=new FileReader;b.onloadend=function(){var m=b.result;m=E?m:m.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=m:location=m,r=null},b.readAsDataURL(i)}else{var F=s.URL||s.webkitURL,_=F.createObjectURL(i);r?r.location=_:location.href=_,r=null,setTimeout(function(){F.revokeObjectURL(_)},4e4)}});s.saveAs=y.saveAs=y,e.exports=y})})(S);var O=S.exports;const I="/DAO_Taiwan_Vue/assets/conbon_c-eUmjNldb.png",M=D("https://daotaiwanapi.onrender.com",{withCredentials:!1});M.on("message",function(e){console.log("伺服器傳送訊息:",e)});const H={data(){return{selectedProduct:null,message:" ",painting:!1,canvas:null,ctx:null,colors:["#C73232","#E6A34B","#EBC352","#FDF673","#D4DAAC","#9BEC58","#4234E9","#A0BEBA","#DDE9F1","#D59CF9"],currentColor:"#C73232",backgroundColor:"#FFFFFF",appWidth:0,lastX:0,lastY:0,showColorPicker:!0,canvasEnabled:!0,isLandscape:!1,rotateButton:null,history:[],redoHistory:[]}},computed:{canvasWidth(){return this.appWidth*.9}},methods:{checkOrientation(e){e.matches?(this.message="您的設備已處於橫向模式",this.rotateButton.style.display="none",this.isLandscape=!0):(this.message="請將您的設備切換至横向模式以獲取更好的體驗",this.rotateButton.style.display="none",this.isLandscape=!1)},homeButton(){this.$router.push("/home")},updateAppWidth(){this.appWidth=this.$refs.appContainer.offsetWidth,this.ctx.strokeStyle=this.currentColor},changeColor(e){this.ctx.strokeStyle=e,this.currentColor=e,this.eraser(!1)},clearCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.backgroundColor="#FFFFFF",this.ctx.fillStyle="#ffffff",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.eraser(!1),alert(`你選擇了${this.selectedProduct}`)},fillCanvas(){this.ctx.fillStyle=this.currentColor,this.backgroundColor=this.currentColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)},startPainting(e){this.painting=!0,e.touches&&e.touches.length>0?(this.history.push(this.canvas.toDataURL()),this.startTouching(e.touches[0])):(this.history.push(this.canvas.toDataURL()),this.draw(e))},draw(e){if(!this.painting||!this.canvasEnabled)return;const t=e.offsetX||e.touches[0].clientX-this.$refs.canvas.offsetLeft,h=e.offsetY||e.touches[0].clientY-this.$refs.canvas.offsetTop;this.ctx.lineWidth=10,this.ctx.lineCap="round",this.ctx.lineTo(t,h),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(t,h)},undo(){console.log("当前历史记录长度:",this.history.length),this.history.length>0?(this.redoHistory.push(this.history.pop()),console.log("执行 Undo 操作后，当前历史记录长度:",this.history.length),this.restoreCanvas(this.history[this.history.length-1]),this.redoHistory.push(this.history.pop())):console.log("历史记录为空，无法执行 Undo 操作")},redo(){this.redoHistory.length>0&&(this.history.push(this.redoHistory.pop()),this.restoreCanvas(this.history[this.history.length-1]),this.history.push(this.redoHistory.pop()),this.restoreCanvas(this.history[this.history.length-1]))},restoreCanvas(e){const t=new Image;t.onload=()=>{this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(t,0,0)},t.src=e},paintingSelect(){this.ctx.strokeStyle=this.currentColor},finishedPainting(){this.painting=!1,this.ctx.beginPath(),this.history.push(this.canvas.toDataURL())},startTouching(e){e.preventDefault(),this.painting=!0,this.history.push(this.canvas.toDataURL()),this.ctx.lineWidth=10,this.ctx.lineCap="round";const t=this.canvas.getBoundingClientRect(),h=e.touches[0].clientX-t.left,c=e.touches[0].clientY-t.top;this.lastX=h,this.lastY=c},dragging(e){e.preventDefault();const t=this.canvas.getBoundingClientRect(),h=e.touches[0].clientX-t.left,c=e.touches[0].clientY-t.top;!this.painting||!this.canvasEnabled||(this.ctx.lineWidth=10,this.ctx.beginPath(),this.ctx.moveTo(this.lastX,this.lastY),this.ctx.lineTo(h,c),this.ctx.stroke(),this.lastX=h,this.lastY=c)},finishDragging(){this.painting=!1,this.ctx.beginPath(),this.history.push(this.canvas.toDataURL())},eraser(e){e?this.ctx.strokeStyle="#FFFFFF":this.ctx.strokeStyle=this.currentColor},saveCanvas(){const e=document.createElement("canvas"),t=e.getContext("2d"),h=1024,c=1024;e.width=h,e.height=c,t.drawImage(this.canvas,0,0,h,c),e.toBlob(l=>{O.saveAs(l,"canvas_image.png")},"image/png")},uploadImage(){const e=document.createElement("canvas"),t=e.getContext("2d");e.width=1024,e.height=1024,t.drawImage(this.canvas,0,0,1024,1024),e.toBlob(h=>{const c=new FormData;c.append("image",h,"canvas_image.png"),c.append("type",this.selectedProduct),fetch("https://daotaiwanapi.onrender.com/upload",{method:"POST",body:c}).then(l=>l.json()).then(l=>{console.log(l),document.cookie=`textureCookie=${JSON.stringify(l.data)}; expires=${new Date(Date.now()+3600*1e3).toUTCString()}; path=/`,alert(JSON.stringify(l.message)),this.$router.push("/result")}).catch(l=>{console.error("Error:",l),alert("Failed to upload image")})},"image/png")},doneDrawing(){this.canvasEnabled=!1,this.showColorPicker=!1}},mounted(){this.canvas=document.getElementById("canvas"),this.ctx=this.canvas.getContext("2d"),this.updateAppWidth(),window.addEventListener("resize",this.updateAppWidth),this.canvas.height=450*.9,this.canvas.width=450*.9;const e=JSON.parse(localStorage.getItem("selectedProduct"));e&&(this.selectedProduct=e),this.$nextTick(()=>{this.ctx.strokeStyle=this.colors[0],this.ctx.fillStyle="#ffffff",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)});const t=window.matchMedia("(orientation: landscape)");this.rotateButton=document.getElementById("rotateButton"),t.addEventListener("change",()=>this.checkOrientation(t)),this.checkOrientation(t),this.updateAppWidth()},beforeUnmount(){window.removeEventListener("resize",this.updateAppWidth)},updated(){this.updateAppWidth()}},p=e=>(U("data-v-34e0c1eb"),e=e(),W(),e),X=p(()=>o("h1",{class:"d-none"},"繪製貼圖",-1)),Y={key:0,class:"d-none"},N={id:"app",class:"position-relative",ref:"appContainer"},z={class:"my-0 mx-auto d-flex justify-content-between align-items-center"},V={class:"w-25"},J=p(()=>o("ion-icon",{name:"chevron-back-outline"},null,-1)),q=[J],G=p(()=>o("img",{class:"logo_sm",src:j,alt:"logo_sm"},null,-1)),K={class:"w-25 d-flex"},Q=p(()=>o("button",{type:"button",id:"rotateButton"},"rotate",-1)),Z={class:"fs-6 d-none"},$={class:"canvas-container"},tt=["width","height"],et=p(()=>o("img",{src:I,class:"overlay-img",alt:"conbon_c"},null,-1)),st={key:0,class:"color-picker"},nt=["onClick"],it={key:1,class:"tool-list d-flex"},ot=p(()=>o("i",{class:"fas fa-paint-brush"},null,-1)),at=[ot],rt=p(()=>o("i",{class:"fab fa-bitbucket"},null,-1)),lt=[rt],ct=p(()=>o("i",{class:"fas fa-eraser"},null,-1)),ht=[ct],dt=p(()=>o("i",{class:"fas fa-trash"},null,-1)),ut=[dt],ft=p(()=>o("i",{class:"fas fa-save"},null,-1)),pt=[ft],gt={key:2,class:"d-flex justify-content-center"};function vt(e,t,h,c,l,n){return v(),g("div",null,[X,l.selectedProduct?(v(),g("div",Y,[o("h2",null,"選中的物件: "+k(l.selectedProduct.name),1),o("p",null,"物件描述: "+k(l.selectedProduct.description),1)])):C("",!0),o("div",N,[o("nav",z,[o("div",V,[o("a",{href:"#",class:"button-circle",onClick:t[0]||(t[0]=f((...s)=>n.homeButton&&n.homeButton(...s),["prevent"]))},q)]),G,o("div",K,[o("a",{class:"done-button",href:"#",onClick:t[1]||(t[1]=f((...s)=>n.doneDrawing&&n.doneDrawing(...s),["prevent"]))},"完成")])]),Q,o("h2",Z,k(l.message),1),o("div",$,[o("canvas",{onMousedown:t[2]||(t[2]=(...s)=>n.startPainting&&n.startPainting(...s)),onMouseup:t[3]||(t[3]=(...s)=>n.finishedPainting&&n.finishedPainting(...s)),onMousemove:t[4]||(t[4]=(...s)=>n.draw&&n.draw(...s)),onTouchstart:t[5]||(t[5]=(...s)=>n.startTouching&&n.startTouching(...s)),onTouchmove:t[6]||(t[6]=(...s)=>n.dragging&&n.dragging(...s)),onTouchend:t[7]||(t[7]=(...s)=>n.finishDragging&&n.finishDragging(...s)),id:"canvas",width:n.canvasWidth,height:n.canvasWidth},null,40,tt),et]),l.showColorPicker?(v(),g("div",st,[(v(!0),g(T,null,R(l.colors,s=>(v(),g("div",{key:s},[o("div",{class:P(["color-box",{currentColor:s===this.currentColor}]),style:A({backgroundColor:s,outlineColor:s}),onClick:x=>n.changeColor(s)},null,14,nt)]))),128))])):C("",!0),l.showColorPicker?(v(),g("div",it,[o("a",{class:"painting-button",onClick:t[8]||(t[8]=f((...s)=>n.paintingSelect&&n.paintingSelect(...s),["prevent"]))},at),o("a",{class:"fill-button",onClick:t[9]||(t[9]=f((...s)=>n.fillCanvas&&n.fillCanvas(...s),["prevent"]))},lt),o("a",{class:"eraser-button",onClick:t[10]||(t[10]=f(s=>n.eraser(!0),["prevent"]))},ht),o("a",{class:"clear-button",onClick:t[11]||(t[11]=f((...s)=>n.clearCanvas&&n.clearCanvas(...s),["prevent"]))},ut),o("a",{class:"save-button",onClick:t[12]||(t[12]=f((...s)=>n.saveCanvas&&n.saveCanvas(...s),["prevent"]))},pt),o("a",{class:"clear-button",onClick:t[13]||(t[13]=f((...s)=>n.undo&&n.undo(...s),["prevent"]))},"Undo"),o("a",{class:"save-button",onClick:t[14]||(t[14]=f((...s)=>n.redo&&n.redo(...s),["prevent"]))},"Redo")])):C("",!0),l.showColorPicker?C("",!0):(v(),g("div",gt,[o("a",{class:"upload-button",href:"#",onClick:t[15]||(t[15]=f((...s)=>n.uploadImage&&n.uploadImage(...s),["prevent"]))},"確認上傳")]))],512)])}const Ct=L(H,[["render",vt],["__scopeId","data-v-34e0c1eb"]]);export{Ct as default};
